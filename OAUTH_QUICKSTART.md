# OAuth Code Assistant - Quick Start

This guide will get you up and running with the OAuth-based code generation workflow in 5 minutes.

## What You'll Get

A Langflow workflow that generates code using:
- **GitHub Copilot** (via OAuth web login)
- **OpenAI Codex** (via OAuth web login)

**No API keys in your workflows!** All authentication is handled via secure OAuth tokens.

## Prerequisites

- Docker and Docker Compose installed
- GitHub account (for Copilot option)
- OpenAI account (for OpenAI option)

## Quick Setup (5 minutes)

### 1. Start OsMEN Services

```bash
cd /home/runner/work/OsMEN/OsMEN
make start
```

Or:

```bash
docker-compose up -d
```

### 2. Choose Your Provider

#### Option A: GitHub Copilot (Recommended for GitHub users)

**Step 1**: Create a GitHub OAuth App

1. Go to: https://github.com/settings/developers
2. Click "OAuth Apps" ‚Üí "New OAuth App"
3. Fill in:
   - **Application name**: `OsMEN Code Assistant`
   - **Homepage URL**: `http://localhost:8000`
   - **Callback URL**: `http://localhost:8000/oauth/github/callback`
4. Click "Register application"
5. Copy the **Client ID**
6. Generate and copy a **Client Secret**

**Step 2**: Configure OAuth

Add to your `.env` file:

```bash
GITHUB_OAUTH_CLIENT_ID=your_client_id_here
GITHUB_OAUTH_CLIENT_SECRET=your_client_secret_here
GITHUB_OAUTH_REDIRECT_URI=http://localhost:8000/oauth/github/callback
```

**Step 3**: Authenticate

1. Visit: http://localhost:8000/oauth/github/login
2. Click "Authorize application" on GitHub
3. You'll be redirected back with confirmation

#### Option B: OpenAI (Recommended for OpenAI users)

**Step 1**: Get your OpenAI API Key

1. Go to: https://platform.openai.com/api-keys
2. Click "Create new secret key"
3. Copy the key (starts with `sk-`)

**Step 2**: Authenticate

1. Visit: http://localhost:8000/oauth/openai/login
2. Paste your API key
3. Click "Authenticate"

### 3. Use the Workflow

#### Via Langflow UI

1. Open Langflow: http://localhost:7860
2. Click "Import Flow"
3. Select: `langflow/flows/code_assistant_oauth.json`
4. Configure the "OAuth Authentication Check" node:
   - Set `provider` to `github` or `openai`
5. Enter a code request:
   ```
   Write a Python function to validate email addresses
   ```
6. Run the workflow!

#### Via Web Dashboard

1. Open: http://localhost:8000/dashboard
2. Navigate to "Code Assistant"
3. Enter your code request
4. The workflow will use your authenticated provider

#### Via API

```python
import requests

# Check authentication status
response = requests.get("http://localhost:8000/oauth/status")
status = response.json()

if status["github"]["authenticated"]:
    print("‚úÖ GitHub authenticated")
elif status["openai"]["authenticated"]:
    print("‚úÖ OpenAI authenticated")
else:
    print("‚ùå Not authenticated - visit login page")
```

## Test Your Setup

Run the test suite:

```bash
python3 test_oauth_integration.py
```

Expected output:
```
‚úÖ PASS - OpenAI OAuth
‚úÖ PASS - Langflow Workflow
‚úÖ PASS - Web Routes
```

## Example Workflow Usage

### 1. Simple Code Generation

**Input:**
```
Write a function to merge two sorted arrays in Python
```

**Output:**
```python
# Generated by GITHUB COPILOT

def merge_sorted_arrays(arr1, arr2):
    """
    Merge two sorted arrays into a single sorted array.
    
    Args:
        arr1: First sorted array
        arr2: Second sorted array
        
    Returns:
        Merged sorted array
    """
    result = []
    i, j = 0, 0
    
    while i < len(arr1) and j < len(arr2):
        if arr1[i] <= arr2[j]:
            result.append(arr1[i])
            i += 1
        else:
            result.append(arr2[j])
            j += 1
    
    result.extend(arr1[i:])
    result.extend(arr2[j:])
    
    return result
```

### 2. With Language Specification

**Input:**
```
Create a REST API endpoint in TypeScript using Express
```

The workflow will detect the language and generate appropriate code.

### 3. Code Explanation

**Input:**
```
Explain this code and suggest improvements:
def f(x): return x*2 if x>0 else 0
```

The AI will provide explanations and refactoring suggestions.

## Common Commands

### Check Authentication Status

```bash
curl http://localhost:8000/oauth/status
```

### Logout

```bash
# GitHub
curl -X POST http://localhost:8000/oauth/github/logout

# OpenAI
curl -X POST http://localhost:8000/oauth/openai/logout
```

### View Logs

```bash
docker-compose logs web
docker-compose logs langflow
```

## Troubleshooting

### "Not authenticated" error

**Solution**: Visit the login page for your provider:
- GitHub: http://localhost:8000/oauth/github/login
- OpenAI: http://localhost:8000/oauth/openai/login

### "Token exchange failed"

**Solution**: 
1. Verify OAuth credentials in `.env`
2. Check redirect URI matches OAuth app configuration
3. Ensure services are running: `docker-compose ps`

### Services not starting

**Solution**:
```bash
docker-compose down
docker-compose up -d
docker-compose logs
```

### Import errors in workflow

**Solution**: Ensure the integrations directory is in Python path:
```bash
export PYTHONPATH="${PYTHONPATH}:/home/runner/work/OsMEN/OsMEN"
```

## Next Steps

1. **Explore the workflow**: Open Langflow UI and customize nodes
2. **Integrate with agents**: Use OAuth in your custom agents
3. **Add more providers**: Extend the workflow for other LLMs
4. **Read full docs**: See `docs/OAUTH_WORKFLOW.md` for details

## Security Notes

- OAuth tokens are stored in `./tokens/` (gitignored)
- Never commit `.env` file or tokens to version control
- Use HTTPS in production
- Rotate OAuth secrets periodically

## Support

- **Documentation**: `docs/OAUTH_WORKFLOW.md`
- **Test Suite**: `python3 test_oauth_integration.py`
- **Logs**: `docker-compose logs web`
- **Status**: http://localhost:8000/oauth/status

## Architecture

```
User Request
    ‚Üì
Langflow Workflow
    ‚Üì
OAuth Check (github/openai)
    ‚Üì
Provider Router
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ GitHub  ‚îÇ  OpenAI  ‚îÇ
‚îÇ Copilot ‚îÇ  Codex   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
Code Output
```

## Files Added

- `integrations/oauth/github_oauth.py` - GitHub OAuth integration
- `integrations/oauth/openai_oauth.py` - OpenAI OAuth integration  
- `web/oauth_routes.py` - FastAPI OAuth routes
- `langflow/flows/code_assistant_oauth.json` - Langflow workflow
- `docs/OAUTH_WORKFLOW.md` - Full documentation
- `test_oauth_integration.py` - Test suite

Enjoy your OAuth-powered code assistant! üöÄ
