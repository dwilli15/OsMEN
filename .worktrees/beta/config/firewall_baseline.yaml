# OsMEN Firewall Baseline Configuration
# Default security rules applied during boot hardening

version: "1.0"
last_updated: "2024-01-01"

# Global Settings
settings:
  default_policy: block  # Block all by default
  log_blocked: true
  log_allowed: false
  alert_on_new_connections: true

# Allowed Applications
allowed_apps:
  # System Critical
  - name: "svchost.exe"
    path: "C:\\Windows\\System32\\svchost.exe"
    direction: both
    reason: "Windows system service"
    
  - name: "Windows Update"
    path: "C:\\Windows\\System32\\wuauclt.exe"
    direction: outbound
    reason: "System updates"
    
  # Browsers
  - name: "Chrome"
    path: "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"
    direction: both
    reason: "Web browser"
    restrictions:
      - block_domains: ["ads.google.com", "doubleclick.net"]
    
  - name: "Firefox"
    path: "C:\\Program Files\\Mozilla Firefox\\firefox.exe"
    direction: both
    reason: "Web browser"
    
  # Development Tools
  - name: "Visual Studio Code"
    path: "C:\\Program Files\\Microsoft VS Code\\Code.exe"
    direction: both
    reason: "Code editor"
    
  - name: "Git"
    path: "C:\\Program Files\\Git\\cmd\\git.exe"
    direction: outbound
    reason: "Version control"
    
  # Communication
  - name: "Teams"
    path: "C:\\Users\\*\\AppData\\Local\\Microsoft\\Teams\\current\\Teams.exe"
    direction: both
    reason: "Business communication"
    schedule:
      - allowed_hours: "08:00-18:00"
      - blocked_hours: "22:00-06:00"

# Blocked Applications
blocked_apps:
  - name: "Torrent Client"
    pattern: "*torrent*.exe"
    reason: "P2P not allowed"
    
  - name: "Suspicious Process"
    pattern: "*miner*.exe"
    reason: "Cryptocurrency mining blocked"

# Port Rules
allowed_ports:
  # Web
  - port: 80
    protocol: tcp
    direction: outbound
    reason: "HTTP"
    
  - port: 443
    protocol: tcp
    direction: outbound
    reason: "HTTPS"
    
  # Docker
  - port: 7860
    protocol: tcp
    direction: both
    reason: "Langflow"
    local_only: true
    
  - port: 5678
    protocol: tcp
    direction: both
    reason: "n8n"
    local_only: true
    
  - port: 8080
    protocol: tcp
    direction: both
    reason: "Agent Gateway"
    local_only: true
    
  - port: 6333
    protocol: tcp
    direction: both
    reason: "Qdrant"
    local_only: true

# Domain Rules
allowed_domains:
  - "github.com"
  - "api.github.com"
  - "api.openai.com"
  - "anthropic.com"
  - "*.amazonaws.com"
  - "docker.io"
  - "pypi.org"

blocked_domains:
  - "ads.*"
  - "tracker.*"
  - "analytics.*"
  - "telemetry.*"

# IP Whitelist (for local services)
allowed_ips:
  - "127.0.0.1"
  - "localhost"
  - "192.168.0.0/16"  # Local network
  - "10.0.0.0/8"      # Docker networks

# Emergency Rules
emergency_block:
  enabled: false
  # When enabled, blocks all non-essential traffic
  allowed_only:
    - "Windows Update"
    - "System Critical"

# Audit Settings
audit:
  log_location: "logs/firewall_audit.log"
  retention_days: 90
  alert_on:
    - "new_application_connection"
    - "blocked_attempt_repeated"
    - "suspicious_port_scan"
