# OsMEN TLS Reverse Proxy (nginx)

This directory provides a hardened reference configuration for terminating TLS in
front of the agent gateway (`agent-gateway` service) and the FastAPI dashboard (`web`).

## Steps

1. **Install nginx + certbot** on the host or edge node.
2. **Issue certificates** (example using certbot):
   ```bash
   sudo certbot certonly --nginx -d app.osmen.local
   ```
3. **Copy `osmen.conf`** to `/etc/nginx/conf.d/` and update:
   - `server_name`
   - `ssl_certificate` paths (generated by certbot)
   - Upstream service names if your compose stack differs
4. **Reload nginx**: `sudo systemctl reload nginx`
5. **Enable redirects in-app** by setting `ENFORCE_HTTPS=true` (in `.env.production`).

## Notes

- TLS termination happens at nginx; traffic between nginx and containers stays on the
  internal Docker network (`osmen-internal`).
- `Strict-Transport-Security` is enabled in the sample config. Keep it in sync with
  the FastAPI middleware security headers (B1.8).
- For local development without TLS, keep `ENFORCE_HTTPS=false` and do not run nginx.
